//@version=5
indicator(title="Trader Circle_Indicator Advanced Filters @byTlos", shorttitle="TC Ind", overlay=true)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ USER INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
minConfirmations = input.int(2, title="Min. Timeframe Confirmations", minval=1, maxval=5)
useRsi  = input.bool(false, title="Use RSI Filter?")
useMacd = input.bool(false, title="Use MACD Filter?")
rsiLength = input.int(14, title="RSI Length")
fastLength   = input.int(12, title="MACD Fast Length")
slowLength   = input.int(26, title="MACD Slow Length")
signalLength = input.int(9,  title="MACD Signal Length")
maType = input.string(defval="EMA", title="Moving Average Type", options=["SMA", "EMA", "RMA", "WMA"])
maLength = input.int(200, title="MA Period", minval=1)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ ALARM AYARLARI â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
enableAlerts = input.bool(true, title="ðŸ”” AlarmlarÄ± EtkinleÅŸtir", group="ALARM AYARLARI")
alertOnLongSignal = input.bool(true, title="ðŸŸ¢ 4H Teyitli Long Sinyal AlarmÄ±", group="ALARM AYARLARI")
alertOnShortSignal = input.bool(true, title="ðŸ”´ 4H Teyitli Short Sinyal AlarmÄ±", group="ALARM AYARLARI")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ COLOR INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
cDailyLong     = input.color(color.lime,    title="GÃ¼nlÃ¼k Long Rengi")
cDailyShort    = input.color(color.red,     title="GÃ¼nlÃ¼k Short Rengi")
cHourlyLong    = input.color(color.blue,    title="Saatlik Long Rengi")
cHourlyShort   = input.color(color.orange,  title="Saatlik Short Rengi")
cTwoHourLong   = input.color(color.purple,  title="2 Saatlik Long Rengi")
cTwoHourShort  = input.color(color.yellow,  title="2 Saatlik Short Rengi")
cFourHourLong  = input.color(color.teal,    title="4 Saatlik Long Rengi")
cFourHourShort = input.color(color.maroon,  title="4 Saatlik Short Rengi")
cWeeklyLong    = input.color(color.fuchsia, title="HaftalÄ±k Long Rengi")
cWeeklyShort   = input.color(color.navy,    title="HaftalÄ±k Short Rengi")
cFinalLong     = input.color(color.lime,    title="MTF+Filter Long Rengi")
cFinalShort    = input.color(color.red,     title="MTF+Filter Short Rengi")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ HELPER FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
f_ma(source, length, type) =>
    switch type
        "SMA" => ta.sma(source, length)
        "EMA" => ta.ema(source, length)
        "RMA" => ta.rma(source, length)
        "WMA" => ta.wma(source, length)

// MACD hesaplama
[macdValue, macdSignal, macdHist] = ta.macd(close, fastLength, slowLength, signalLength)

// RSI hesaplama
rsiValue = ta.rsi(close, rsiLength)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ MULTI-TIMEFRAME DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
dailyOpen   = request.security(syminfo.tickerid, 'D',   open,  lookahead=barmerge.lookahead_on)
dailyClose  = request.security(syminfo.tickerid, 'D',   close, lookahead=barmerge.lookahead_on)
dailyHigh   = request.security(syminfo.tickerid, 'D',   high,  lookahead=barmerge.lookahead_on)
dailyLow    = request.security(syminfo.tickerid, 'D',   low,   lookahead=barmerge.lookahead_on)
plot(dailyHigh, color=color.new(color.gray, 0), title='Daily High', style=plot.style_cross, linewidth=1)
plot(dailyLow,  color=color.new(color.gray, 0), title='Daily Low',  style=plot.style_cross, linewidth=1)

hourlyOpen   = request.security(syminfo.tickerid, '60',  open,  lookahead=barmerge.lookahead_on)
hourlyClose  = request.security(syminfo.tickerid, '60',  close, lookahead=barmerge.lookahead_on)

twoHourOpen  = request.security(syminfo.tickerid, '120', open,  lookahead=barmerge.lookahead_on)
twoHourClose = request.security(syminfo.tickerid, '120', close, lookahead=barmerge.lookahead_on)

fourHourOpen  = request.security(syminfo.tickerid, '240', open,  lookahead=barmerge.lookahead_on)
fourHourClose = request.security(syminfo.tickerid, '240', close, lookahead=barmerge.lookahead_on)

weeklyOpen  = request.security(syminfo.tickerid, 'W', open,  lookahead=barmerge.lookahead_on)
weeklyClose = request.security(syminfo.tickerid, 'W', close, lookahead=barmerge.lookahead_on)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ TIMEFRAME SIGNALS â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
bool dailyLong   = ta.crossover(dailyClose,  dailyOpen)
bool dailyShort  = ta.crossunder(dailyClose, dailyOpen)
bool hourlyLong   = ta.crossover(hourlyClose,  hourlyOpen)
bool hourlyShort  = ta.crossunder(hourlyClose, hourlyOpen)
bool twoHourLong   = ta.crossover(twoHourClose,   twoHourOpen)
bool twoHourShort  = ta.crossunder(twoHourClose,  twoHourOpen)
bool fourHourLong   = ta.crossover(fourHourClose,   fourHourOpen)
bool fourHourShort  = ta.crossunder(fourHourClose,  fourHourOpen)
bool weeklyLong   = ta.crossover(weeklyClose,   weeklyOpen)
bool weeklyShort  = ta.crossunder(weeklyClose,  weeklyOpen)

// Her zaman dilimi iÃ§in shape plotlarÄ± - Sadece MTF sinyalleri (plot sayÄ±sÄ±nÄ± azaltmak iÃ§in)
// Bireysel timeframe sinyalleri kaldÄ±rÄ±ldÄ± (plot limitini aÅŸmamak iÃ§in)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONFIRMATION LOGIC â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
longCount  = (dailyLong ? 1 : 0) + (hourlyLong ? 1 : 0) + (twoHourLong ? 1 : 0) + (fourHourLong ? 1 : 0) + (weeklyLong ? 1 : 0)
shortCount = (dailyShort ? 1 : 0) + (hourlyShort ? 1 : 0) + (twoHourShort ? 1 : 0) + (fourHourShort ? 1 : 0) + (weeklyShort ? 1 : 0)

bool combinedLong  = longCount  >= minConfirmations and shortCount == 0
bool combinedShort = shortCount >= minConfirmations and longCount  == 0

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ INDICATOR FILTERS (RSI / MACD) â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
bool passRsiLong  = rsiValue > 50
bool passRsiShort = rsiValue < 50
bool passMacdLong  = macdValue > macdSignal
bool passMacdShort = macdValue < macdSignal

bool finalLongFilter  = (not useRsi or passRsiLong)  and (not useMacd or passMacdLong)
bool finalShortFilter = (not useRsi or passRsiShort) and (not useMacd or passMacdShort)

//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MTF VOLUME & MOMENTUM OSCILLATOR KODLARI
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
volumeLookback      = input.int (10 , "Hacim Ortalama Periyodu" , minval = 1)
momentumLookback    = input.int (10 , "Momentum Periyodu"       , minval = 1)
smoothLen           = input.int (1  , "Sinyal EMA YumuÅŸatma"    , minval = 1)
atrLen              = input.int (11 , "ATR Periyodu"            , minval = 1)
atrSensitivity      = input.float(1 , "ATR-Renk Hassasiyet Ã‡arpanÄ±", minval = 0, step = 0.1)
deltaMode           = input.bool(true, "Delta Modu (Pozitif/Negatif AyrÄ± GÃ¶ster)")

// DELTA MOD ÅžERÄ°T SEVÄ°YELERÄ°
h4V_pos_lane = 32
h4V_neg_lane = 34
h4M_pos_lane = 36
h4M_neg_lane = 38

// RENK PALETÄ°
weakBull   = color.rgb(  0,170,  0, 50)   // sÃ¶nÃ¼k yeÅŸil
strongBull = color.rgb(  0,255,  0,  0)   // parlak yeÅŸil
weakBear   = color.rgb(170,  0,  0, 50)   // sÃ¶nÃ¼k kÄ±rmÄ±zÄ±
strongBear = color.rgb(255,  0,  0,  0)   // parlak kÄ±rmÄ±zÄ±
neutralCol = color.new(color.yellow, 80)  // kararsÄ±z

// YARDIMCI FONKSÄ°YONLAR
getVolumeSignal(vol, volMA, cls, opn) =>
    ratio   = vol / volMA
    bullish = cls > opn
    bearish = cls < opn
    if deltaMode
        if bullish
            ratio > 1.2 ? 1 : (ratio < 0.8 ? 0.5 : 0.3)
        else
            ratio > 1.2 ? -1 : (ratio < 0.8 ? -0.5 : -0.3)
    else
        ratio > 1.2 ? (bullish ? 1 : bearish ? -1 : 0) : ratio < 0.8 ? (bullish ? 0.5 : bearish ? -0.5 : 0) : 0

getMomentumSignal(cls, lb) =>
    delta = cls - cls[lb]
    if deltaMode
        if delta > 0
            delta >  cls * 0.01 ?  1   :  0.5
        else
            delta < -cls * 0.01 ? -1   : -0.5
    else
        delta > 0 ? (delta >  cls * 0.01 ?  1   :  0.5) : delta < 0 ? (delta < -cls * 0.01 ? -1   : -0.5) : 0

smooth(sig) => ta.ema(sig, smoothLen)
volAdj(atr, cls) => 1 + (atr / cls) * atrSensitivity
getColor(sig, factor) =>
    strength = math.min(1.0, math.abs(sig) * factor)
    sig > 0  ? color.from_gradient(strength, 0, 1, weakBull, strongBull) : sig < 0  ? color.from_gradient(strength, 0, 1, weakBear, strongBear) : neutralCol

// SÄ°NYAL ÃœRET & GÃ–STER
securitySignals(tf, laneVolPos, laneVolNeg, laneMomPos, laneMomNeg)=>
    cls  = request.security(syminfo.tickerid, tf, close , lookahead = barmerge.lookahead_on)
    opn  = request.security(syminfo.tickerid, tf, open  , lookahead = barmerge.lookahead_on)
    vol  = request.security(syminfo.tickerid, tf, volume, lookahead = barmerge.lookahead_on)
    vMA  = request.security(syminfo.tickerid, tf, ta.sma(volume, volumeLookback),   lookahead = barmerge.lookahead_on)
    atr  = request.security(syminfo.tickerid, tf, ta.atr(atrLen)                ,   lookahead = barmerge.lookahead_on)

    vSig = smooth(getVolumeSignal(vol, vMA, cls, opn))
    mSig = smooth(getMomentumSignal(cls, momentumLookback))

    factor = volAdj(atr, cls)

    vCol = getColor(vSig, factor)
    mCol = getColor(mSig, factor)

    vPosPlot = vSig > 0 ? laneVolPos : na
    vNegPlot = vSig < 0 ? laneVolNeg : na
    mPosPlot = mSig > 0 ? laneMomPos : na
    mNegPlot = mSig < 0 ? laneMomNeg : na

    [vCol, mCol, vPosPlot, vNegPlot, mPosPlot, mNegPlot, vSig, mSig]

// 4H sinyalleri hesapla
[h4VCol, h4MCol, h4VPosPlot, h4VNegPlot, h4MPosPlot, h4MNegPlot, h4VSig, h4MSig] = securitySignals('240', h4V_pos_lane, h4V_neg_lane, h4M_pos_lane, h4M_neg_lane)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4H MOMENTUM VE HACÄ°M TEYÄ°TÄ° â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
bool h4MomentumConfirm = h4MSig > 0  // 4H momentum pozitif
bool h4VolumeConfirm = h4VSig > 0    // 4H hacim pozitif
bool h4MomentumBearish = h4MSig < 0  // 4H momentum negatif
bool h4VolumeBearish = h4VSig < 0    // 4H hacim negatif

// 4H teyit - hem momentum hem hacim aynÄ± yÃ¶nde olmalÄ±
bool h4BullishConfirm = h4MomentumConfirm and h4VolumeConfirm
bool h4BearishConfirm = h4MomentumBearish and h4VolumeBearish

// FINAL SÄ°NYALLER - 4H TEYÄ°TLÄ°
bool finalLong  = combinedLong  and finalLongFilter and h4BullishConfirm
bool finalShort = combinedShort and finalShortFilter and h4BearishConfirm

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ STRATEGY LOGIC â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
// if finalLong
    // strategy.close("Short")  // Short pozisyonu kapat
    // strategy.entry("Long", strategy.long)  // Long pozisyon aÃ§

// if finalShort
    // strategy.close("Long")  // Long pozisyonu kapat
    // strategy.entry("Short", strategy.short)  // Short pozisyon aÃ§

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ PLOT COMBINED SIGNALS (4H TEYÄ°TLÄ°) â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
plotshape(series=finalLong,  title="MTF+4H Teyitli Long",  style=shape.triangleup,   location=location.belowbar, color=cFinalLong,  size=size.normal, text="4H Teyitli Long",  textcolor=cFinalLong)
plotshape(series=finalShort, title="MTF+4H Teyitli Short", style=shape.triangledown, location=location.abovebar, color=cFinalShort, size=size.normal, text="4H Teyitli Short", textcolor=cFinalShort)

//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ALARM KOÅžULLARI - 4H TEYÄ°TLÄ° SÄ°NYALLER (KULLANICI AYARLARINA GÃ–RE)
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// 4H Teyitli Long Alarm
alertcondition(condition = enableAlerts and alertOnLongSignal and finalLong, title = "ðŸŸ¢ 4H Teyitli LONG Sinyali", message = "ðŸš€ 4H TEYÄ°TLÄ° LONG SÄ°NYALÄ°!\nðŸ“Š Sembol: {{ticker}}\nâ° Zaman: {{time}}\nðŸ’° Fiyat: {{close}}\nâœ… 4H Momentum: Pozitif\nâœ… 4H Hacim: Pozitif\nðŸ“ˆ Long pozisyon aÃ§Ä±labilir!")

// 4H Teyitli Short Alarm
alertcondition(condition = enableAlerts and alertOnShortSignal and finalShort, title = "ðŸ”´ 4H Teyitli SHORT Sinyali", message = "ðŸ“‰ 4H TEYÄ°TLÄ° SHORT SÄ°NYALÄ°!\nðŸ“Š Sembol: {{ticker}}\nâ° Zaman: {{time}}\nðŸ’° Fiyat: {{close}}\nâŒ 4H Momentum: Negatif\nâŒ 4H Hacim: Negatif\nðŸ“‰ Short pozisyon aÃ§Ä±labilir!")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ EK ALARM AYARLARI â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
enableStrongSignalAlerts = input.bool(true, title="ðŸ”” GÃ¼Ã§lÃ¼ Sinyal AlarmlarÄ±", group="ALARM AYARLARI")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ PULLBACK LEVELS â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
var float long_pullback_level  = na
var float short_pullback_level = na

if finalLong
    long_pullback_level := low

if finalShort
    short_pullback_level := high

plot(long_pullback_level,  color=color.green, linewidth=2, style=plot.style_stepline, title="Long Pullback Level")
plot(short_pullback_level, color=color.red,   linewidth=2, style=plot.style_stepline, title="Short Pullback Level")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ MOVING AVERAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€ //
signalMA = f_ma(close, maLength, maType)
plot(signalMA, title="Sinyal OrtalamasÄ±", color=#ec088d, linewidth=2)

//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EK ÅžERÄ°T SEVÄ°YELERÄ° TANIMLAMALARI (1H, 2H)
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1H
h1V_pos_lane = 12
h1V_neg_lane = 14
h1M_pos_lane = 16
h1M_neg_lane = 18
// 2H
h2V_pos_lane = 22
h2V_neg_lane = 24
h2M_pos_lane = 26
h2M_neg_lane = 28

// 1H ve 2H sinyalleri de hesapla (gÃ¶sterme amaÃ§lÄ±)
[h1VCol, h1MCol, h1VPosPlot, h1VNegPlot, h1MPosPlot, h1MNegPlot, h1VSig, h1MSig] = securitySignals('60', h1V_pos_lane, h1V_neg_lane, h1M_pos_lane, h1M_neg_lane)
[h2VCol, h2MCol, h2VPosPlot, h2VNegPlot, h2MPosPlot, h2MNegPlot, h2VSig, h2MSig] = securitySignals('120', h2V_pos_lane, h2V_neg_lane, h2M_pos_lane, h2M_neg_lane)

//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENKLÄ° Ã‡Ä°ZGÄ°LER - KALDIRILIYOR (Grafik hareketi sorunu Ã§Ã¶zÃ¼mÃ¼)
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Sabit konumlu Ã§izgiler yerine tablo kullanacaÄŸÄ±z

//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 4H SÄ°NYAL TAKIP SÄ°STEMÄ° - SADECE BÄ°LGÄ° TABLOSU
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Grafik hareketi Ã¶nlemek iÃ§in plotshape kaldÄ±rÄ±ldÄ±, sadece tablo kullanÄ±lÄ±yor

//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GÃœÃ‡LÃœ ALIM/SATIM SÄ°NYALÄ° - MUM BAZLÄ°
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Fonksiyon: AynÄ± zaman diliminde momentum ve hacmin uyumunu deÄŸerlendir
timeframeSignal(vSig, mSig) =>
    if vSig > 0.7 and mSig > 0.7
        1  // GÃ¼Ã§lÃ¼ AlÄ±m
    else if vSig < -0.7 and mSig < -0.7
        -1 // GÃ¼Ã§lÃ¼ SatÄ±m
    else
        0  // NÃ¶tr

// Her zaman dilimi iÃ§in sinyal gÃ¼cÃ¼nÃ¼ hesapla
h1Signal = timeframeSignal(h1VSig, h1MSig)
h2Signal = timeframeSignal(h2VSig, h2MSig)
h4Signal = timeframeSignal(h4VSig, h4MSig)

// Zaman dilimleri arasÄ± sinyal gÃ¼cÃ¼nÃ¼ birleÅŸtir
overallSignal = h1Signal + h2Signal + h4Signal

// Sinyal eÅŸik deÄŸerleri
buyThreshold  = 2  // AlÄ±m iÃ§in minimum sinyal gÃ¼cÃ¼
sellThreshold = -2 // SatÄ±m iÃ§in minimum sinyal gÃ¼cÃ¼

// Ã–nceki sinyali saklamak iÃ§in deÄŸiÅŸken
var string previousSignal = "NÃ¶tr"

// AnlÄ±k sinyali belirle
currentSignal = overallSignal >= buyThreshold ? "Al" : overallSignal <= sellThreshold ? "Sat" : "NÃ¶tr"

// Sinyal deÄŸiÅŸtiÄŸinde tetikleme
newSignal = currentSignal != previousSignal

// Sinyal gÃ¶stergeleri
buySignal = newSignal and currentSignal == "Al"
sellSignal = newSignal and currentSignal == "Sat"

// GÃœÃ‡LÃœ SÄ°NYAL ALARMLARI - BURADA TANIMLANMALIDIR (buySignal ve sellSignal tanÄ±mlandÄ±ktan sonra)
alertcondition(condition = enableAlerts and enableStrongSignalAlerts and buySignal, title = "ðŸš€ GÃ¼Ã§lÃ¼ AlÄ±m Sinyali", message = "ðŸš€ GÃœÃ‡LÃœ ALIM SÄ°NYALÄ°!\nðŸ“Š Sembol: {{ticker}}\nâ° Zaman: {{time}}\nðŸ’° Fiyat: {{close}}\nðŸ“ˆ 1H+2H+4H Momentum ve Hacim Pozitif\nâš¡ GÃ¼Ã§lÃ¼ alÄ±m fÄ±rsatÄ±!")

alertcondition(condition = enableAlerts and enableStrongSignalAlerts and sellSignal, title = "ðŸ“‰ GÃ¼Ã§lÃ¼ SatÄ±m Sinyali", message = "ðŸ“‰ GÃœÃ‡LÃœ SATIM SÄ°NYALÄ°!\nðŸ“Š Sembol: {{ticker}}\nâ° Zaman: {{time}}\nðŸ’° Fiyat: {{close}}\nðŸ“‰ 1H+2H+4H Momentum ve Hacim Negatif\nâš¡ GÃ¼Ã§lÃ¼ satÄ±m fÄ±rsatÄ±!")

// Sinyalleri Ã§iz - MUM BAZLÄ° KONUM
plotshape(buySignal, style=shape.arrowup, location=location.belowbar, color=color.lime, size=size.large, title="GÃ¼Ã§lÃ¼ AlÄ±m Sinyali")
plotshape(sellSignal, style=shape.arrowdown, location=location.abovebar, color=color.red, size=size.large, title="GÃ¼Ã§lÃ¼ SatÄ±m Sinyali")

// Ã–nceki sinyali gÃ¼ncelle
previousSignal := currentSignal

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ BÄ°LGÄ° TABLOSU - 4H TEYÄ°T DURUMU
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 4H TEYÄ°T DURUMU BÄ°LGÄ°SÄ°
h4Status = h4BullishConfirm ? "ðŸŸ¢ BULLISH" : h4BearishConfirm ? "ðŸ”´ BEARISH" : "ðŸŸ¡ NÃ–TR"
h4MomStatus = h4MSig > 0 ? "ðŸŸ¢ Pozitif" : h4MSig < 0 ? "ðŸ”´ Negatif" : "ðŸŸ¡ NÃ¶tr"
h4VolStatus = h4VSig > 0 ? "ðŸŸ¢ Pozitif" : h4VSig < 0 ? "ðŸ”´ Negatif" : "ðŸŸ¡ NÃ¶tr"
overallStatus = finalLong ? "ðŸŸ¢ LONG" : finalShort ? "ðŸ”´ SHORT" : "âšª BEKLÄ°YOR"

// Tablo oluÅŸtur (Her bar'da gÃ¼ncellenir)
var table infoTable = na
if barstate.islast
    // Tabloyu sil ve yeniden oluÅŸtur
    if not na(infoTable)
        table.delete(infoTable)
    
    // Yeni tablo oluÅŸtur
    infoTable := table.new(position.top_right, 2, 5, bgcolor=color.new(color.black, 85), border_width=2, border_color=color.white)
    
    // BaÅŸlÄ±k satÄ±rÄ±
    table.cell(infoTable, 0, 0, "ðŸ“Š 4H TEYÄ°T SÄ°STEMÄ°", text_color=color.white, text_size=size.normal, bgcolor=color.new(color.blue, 70))
    table.cell(infoTable, 1, 0, h4Status, text_color=color.white, text_size=size.normal, bgcolor=color.new(color.blue, 70))
    
    // Momentum durumu
    table.cell(infoTable, 0, 1, "ðŸ“ˆ 4H Momentum", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 1, h4MomStatus, text_color=color.white, text_size=size.small)
    
    // Hacim durumu
    table.cell(infoTable, 0, 2, "ðŸ“Š 4H Hacim", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 2, h4VolStatus, text_color=color.white, text_size=size.small)
    
    // Final sinyal durumu
    table.cell(infoTable, 0, 3, "ðŸŽ¯ Final Sinyal", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 3, overallStatus, text_color=color.white, text_size=size.small)
    
    // MTF DoÄŸrulama sayÄ±sÄ±
    mtfInfo = str.tostring(longCount) + " Long / " + str.tostring(shortCount) + " Short"
    table.cell(infoTable, 0, 4, "ðŸ”„ MTF SayÄ±m", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 4, mtfInfo, text_color=color.white, text_size=size.small)
